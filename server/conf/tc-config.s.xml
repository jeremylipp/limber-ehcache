<?xml version="1.0" encoding="UTF-8"?>
<tc-config xmlns="http://www.terracotta.org/config"
           xmlns:ohr="http://www.terracotta.org/config/offheap-resource">
  <!--
    This is the default Terracotta server configuration file for the Ehcache kit.

    It defines a single offheap resource of 512MB to be used for caching data.

    It also defines a single server, but you can add another one to benefit from high availability.
  -->

  <plugins>
    <config>
      <ohr:offheap-resources>
        <ohr:resource name="main" unit="MB">512</ohr:resource>
      </ohr:offheap-resources>
    </config>
  </plugins>

  <tc-properties>
      <property name="l2.l1reconnect.enabled" value="true" />
 	  <property name="l2.l1reconnect.timeout.millis" value="20000" />

 	  <!-- Tolerant timeout settings taken from: http://www.terracotta.org/documentation/high-availability.html -->
      <!-- l1 to l2 is Client timing out (and disconnecting from) the Server  -->
      <property name="l1.healthcheck.l2.ping.enabled" value="true" />
      <property name="l1.healthcheck.l2.ping.idletime" value="5000" />
      <property name="l1.healthcheck.l2.ping.interval" value="1000" />
      <property name="l1.healthcheck.l2.ping.probes" value="3" />
      <property name="l1.healthcheck.l2.socketConnect" value="true" />
      <property name="l1.healthcheck.l2.socketConnectTimeout" value="5" />
      <property name="l1.healthcheck.l2.socketConnectCount" value="20" />

      <!-- Tolerant timeout settings taken from: http://www.terracotta.org/documentation/high-availability.html -->
      <!-- l2 to l1 is Server timing out (and ejecting) the Client  -->
      <property name="l2.healthcheck.l1.ping.enabled" value="true" />
      <property name="l2.healthcheck.l1.ping.idletime" value="5000" />
      <property name="l2.healthcheck.l1.ping.interval" value="1000" />
      <property name="l2.healthcheck.l1.ping.probes" value="3" />
      <property name="l2.healthcheck.l1.socketConnect" value="true" />
      <property name="l2.healthcheck.l1.socketConnectTimeout" value="5" />
      <property name="l2.healthcheck.l1.socketConnectCount" value="20" />

      <!-- Trying to set debug options here-->
      <property name="l2.transactionmanager.logging.verbose" value="true"/>
      <property name="session.debug.invalidate" value="true"/>
      <property name="session.debug.sessions" value="true"/>

      <!-- Max log file size 50MB -->
      <property name="logging.maxLogFileSize" value="50"/>
  </tc-properties>

  <servers>
    <server host="localhost" name="default-server">
      <!--
        Indicates the location for logs files - %H will resolve to user home directory.
        Note that relative path will be resolved from the location of this configuration file.
       -->
      <logs>%H/terracotta-logs</logs>

      <!--
        This port is used by clients to communicate to the server.
        Its value is actually the default one and is thus omitted.
      -->
      <!--<tsa-port>9410</tsa-port>-->

      <!--
        This port is used for server to server communication.
        Its value is actually the default one and is thus omitted.
      -->
      <!--<tsa-group-port>9430</tsa-group-port>-->
      <dso>
          <persistence>
            <mode>permanent-store</mode>
          </persistence>
      </dso>
    </server>

    <!--
      Below a sample server definition that will give HA to the cluster if run on a different host.

      Servers know how to communicate between each others because each version of the config file on each host
      will list all servers in it.
    -->
    <!--<server host="otherhost" name="other-server">-->
      <!--<logs>logs</logs>-->
      <!--<tsa-port>9410</tsa-port>-->
    <!--</server>-->

    <!--
      Indicates how much time a server taking over after a failure in an active will wait
      to allow existing clients to reconnect. The time unit is seconds.
    -->
    <client-reconnect-window>120</client-reconnect-window>
  </servers>
  <failover-priority>
    <availability/>
  </failover-priority>
</tc-config>
